---
# tasks file for geonmo.dcache
- name: Configure Java JDK
  package:
    name:
      - java-17-openjdk-headless 
      - httpd-tools
    state: present
- name: Checking dcache package
  package_facts:
    manager: auto
- name: Print dcache version
  debug:
    msg: "{{ dcache_version }}"
- name: Print dcache release version
  debug:
    msg: "{{ dcache_version | regex_search('([0-9]+\\.[0-9]+)') }}"
- name: Install dcache package
  yum:
    name: "https://dcache.org/old/downloads/1.9/repo/{{ dcache_version | regex_search('([0-9]+\\.[0-9]+)') }}/dcache-{{ dcache_version }}-1.noarch.rpm"
    state: present
    disable_gpg_check: true
  when: "'dcache' not in ansible_facts.packages"
- name: Check hostcert file
  copy: 
    src: files/{{ ansible_hostname }}_hostcert.pem
    dest: /etc/grid-security/hostcert.pem
    owner: dcache
    group: dcache
    mode: "0644"
- name: Check hostkey file
  copy: 
    src: files/{{ ansible_hostname }}_hostkey.pem
    dest: /etc/grid-security/hostkey.pem
    owner: dcache
    group: dcache
    mode: "0400"
- name: "Check {{ volume_path }}"
  file:
    path: "{{ volume_path }}"
    owner: dcache
    group: dcache
    state: directory

- name: Configure dcache
  include_tasks: "{{ type }}.yml"

